#include <windows.h> // Windows头文件
#include <stdio.h>
#include "SDL.h"
#include <stdlib.h>
#include <time.h>
#include "sgl.h"
#include "../source/libs/sgl_string.h"
#include "../source/draw/sgl_draw_icon.h"

SDL_Event myEvent; //SDL事件

SDL_Window * m_window = NULL;
SDL_Renderer * m_renderer = NULL;


#define FRAME_BUFFER_XRES   240
#define FRAME_BUFFER_YRES   320
#define FRAME_BUFFER_XRES_VIRTUAL   240
#define FRAME_BUFFER_YRES_VIRTUAL   320

sgl_color_t sdl2_frame_buffer[FRAME_BUFFER_XRES_VIRTUAL * FRAME_BUFFER_YRES_VIRTUAL] = {0};

sgl_color_t sdl2_draw_buffer[20 * FRAME_BUFFER_XRES] = {0};

static int sdl_show_windows(SDL_Window **m_window, SDL_Renderer **m_renderer)
{
    if ( SDL_CreateWindowAndRenderer( FRAME_BUFFER_XRES_VIRTUAL, FRAME_BUFFER_YRES_VIRTUAL, SDL_WINDOW_SHOWN,
                                      &(*m_window), &(*m_renderer )) != 0 )
        return -1;

    // Clear the window with a black background
    for(int i = 0; i< FRAME_BUFFER_XRES * FRAME_BUFFER_YRES; i++) {
        sdl2_frame_buffer[i] = SGL_WHITE;
    }
    SDL_SetRenderDrawColor( *m_renderer, 0, 0, 0, 255);
    SDL_RenderClear( *m_renderer );
    return 0;
}

static void sgl_disp_pixel(int16_t x, int16_t y, sgl_color_t color)
{
    sdl2_frame_buffer[y*FRAME_BUFFER_XRES_VIRTUAL + x] =  color;
}


static void sdl2_disp_area(int16_t x1, int16_t y1, int16_t x2, int16_t y2, const sgl_color_t *src)
{
    const sgl_color_t *color = src;
    int16_t x = x1, y = y1, hight = y2 - y1 + 1, width = x2 - x1 + 1;
    for(int i = y; i < (hight + y); i++ )
    {
        for(int j = x; j < (width + x) ; j ++ )
        {
           sgl_disp_pixel(j, i, *color);
           color ++;
        }
    }
}

static void update_win(SDL_Renderer * m_renderer)
{
    SDL_Texture *texture = SDL_CreateTexture(m_renderer, SDL_PIXELFORMAT_ARGB8888, SDL_TEXTUREACCESS_STREAMING, FRAME_BUFFER_XRES_VIRTUAL, FRAME_BUFFER_YRES_VIRTUAL);
    SDL_UpdateTexture(texture, NULL, sdl2_frame_buffer, FRAME_BUFFER_XRES_VIRTUAL * 4);
    SDL_RenderCopy(m_renderer, texture, NULL, NULL);
    SDL_RenderPresent(m_renderer);
}


Uint32 fb_update(Uint32 interval, void *param)//回调函数 
{
	update_win(m_renderer);
	return interval;
}

//sgl task定时器
Uint32 sgl_system_tick(Uint32 interval, void *param)//回调函数 
{
	sgl_tick_inc(5);
    sgl_task_handler();
	return interval;
}

sgl_event_pos_t sdl_mouse_get(void *data)
{
    sgl_event_pos_t ev_pos;
    SDL_Event *event = (SDL_Event*)data;
    switch (event->type)
    {
    case SDL_MOUSEBUTTONDOWN:
        ev_pos.x = event->motion.x;
        ev_pos.y = event->motion.y;
        ev_pos.type = SGL_EVENT_PRESSED;
        break;
    case SDL_MOUSEBUTTONUP:
        ev_pos.x = event->motion.x;
        ev_pos.y = event->motion.y;
        ev_pos.type = SGL_EVENT_RELEASED;
        break;
    default: ev_pos.type = SGL_EVENT_NULL;
    }
    return ev_pos;
}

// 鼠标中断处理函数
int sgl_mouse_event_interrupt(void *userdata, SDL_Event *event) 
{
    sgl_device_input_handle(event);
    return 0;
}

const uint8_t test_bitmap[]  = {

0x00,0x00,0x00,0x3e,0xc0,0x00,0x00,0x00,  //.......@%.......
0x00,0x00,0x00,0xaf,0xe5,0x00,0x00,0x00,  //......%@@+......
0x00,0x00,0x00,0xee,0xec,0x00,0x00,0x00,  //......@@@%......
0x00,0x00,0x08,0xc8,0xae,0x50,0x00,0x00,  //.....+%+%@+.....
0x00,0x35,0x8e,0xe0,0x3e,0xe8,0x53,0x00,  //...++@@..@@++...
0xef,0xff,0xca,0x50,0x08,0xce,0xff,0xfe,  //@@@@%%+..+%@@@@@
0xae,0xc0,0x00,0x00,0x00,0x00,0x3e,0xe5,  //%@%..........@@+
0x08,0xec,0x00,0x00,0x00,0x03,0xee,0x50,  //.+@%........@@+.
0x00,0x8e,0xc0,0x00,0x00,0x3e,0xe5,0x00,  //..+@%......@@+..
0x00,0x0a,0xe3,0x00,0x00,0x8c,0x80,0x00,  //...%@.....+%+...
0x00,0x0c,0xe0,0x00,0x00,0x5e,0xa0,0x00,  //...%@.....+@%...
0x00,0x0e,0xc0,0x5c,0xc3,0x3e,0xc0,0x00,  //...@%.+%%..@%...
0x00,0x3e,0xcc,0xfc,0xee,0xce,0xe0,0x00,  //...@%%@%@@%@@...
0x00,0x5e,0xfc,0x50,0x05,0xef,0xe3,0x00,  //..+@@%+..+@@@...
0x00,0x5a,0x50,0x00,0x00,0x08,0xa3,0x00,  //..+%+......+%...

};
sgl_obj_t *two_page;
sgl_obj_t *main_page;


sgl_rect_t rect1 = {.x1 = 10, .y1 = 20, .x2 = 400,  .y2= 300,};
sgl_rect_t rect2 = {.x1 = 30, .y1 = 40, .x2 = 220,  .y2= 120,};
sgl_rect_t rect3 = {.x1 = 50, .y1 = 60, .x2 = 240,  .y2= 140,};

void btn_event(sgl_obj_t *obj, void *data)
{
    if(sgl_obj_get_event_status(obj) == SGL_EVENT_PRESSED) {
        SGL_LOG_INFO("buttton pressed");
    }
    else if(sgl_obj_get_event_status(obj) == SGL_EVENT_RELEASED) {
        SGL_LOG_INFO("buttton released");
    };
}

extern unsigned char bg_test[460800];
extern unsigned char icon_test[11236];
extern unsigned char button_img[12544];
extern unsigned char sw_on[16728];
extern unsigned char sw_off[16728];

uint8_t test[] = {

0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x27,0x77,0x77,0x77,0x30,0x00,0x00,0x00,0x00,  //...............................+++++++.........
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5f,0xff,0xff,0xff,0x70,0x00,0x00,0x00,0x00,  //..............................+@@@@@@@+........
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5f,0xff,0xff,0xff,0x70,0x00,0x00,0x00,0x00,  //..............................+@@@@@@@+........
0x00,0x00,0x00,0x00,0x00,0x15,0x55,0x55,0x55,0x30,0x00,0x00,0x00,0x00,0x00,0x5f,0xff,0xff,0xff,0x70,0x00,0x00,0x00,0x00,  //...........+++++++............+@@@@@@@+........
0x00,0x00,0x00,0x00,0x00,0x7f,0xff,0xff,0xff,0x80,0x00,0x00,0x00,0x00,0x00,0x5f,0xff,0xff,0xff,0x70,0x00,0x00,0x00,0x00,  //..........+@@@@@@@+...........+@@@@@@@+........
0x00,0x00,0x00,0x00,0x00,0x9f,0xff,0xff,0xff,0x50,0x00,0x00,0x00,0x00,0x00,0x5f,0xff,0xff,0xff,0x70,0x00,0x00,0x00,0x00,  //..........+@@@@@@@+...........+@@@@@@@+........
0x00,0x00,0x00,0x00,0x00,0xcf,0xff,0xff,0xff,0x20,0x00,0x00,0x00,0x00,0x00,0x5f,0xff,0xff,0xff,0x70,0x00,0x00,0x00,0x00,  //..........%@@@@@@@............+@@@@@@@+........
0x00,0x00,0x00,0x00,0x00,0xff,0xff,0xff,0xfe,0x00,0x00,0x00,0x00,0x00,0x00,0x5f,0xff,0xff,0xff,0x70,0x00,0x00,0x00,0x00,  //..........@@@@@@@@............+@@@@@@@+........
0x00,0x00,0x00,0x00,0x03,0xff,0xff,0xff,0xfb,0x00,0x00,0x00,0x00,0x00,0x00,0x5f,0xff,0xff,0xff,0x70,0x00,0x00,0x00,0x00,  //..........@@@@@@@%............+@@@@@@@+........
0x00,0x00,0x00,0x00,0x06,0xff,0xff,0xff,0xf8,0x00,0x00,0x00,0x00,0x00,0x00,0x5f,0xff,0xff,0xff,0x70,0x00,0x00,0x00,0x00,  //.........+@@@@@@@+............+@@@@@@@+........
0x00,0x00,0x00,0x00,0x09,0xff,0xff,0xff,0xf6,0x00,0x00,0x00,0x00,0x00,0x00,0x5f,0xff,0xff,0xff,0x70,0x00,0x00,0x00,0x00,  //.........+@@@@@@@+............+@@@@@@@+........
0x00,0x00,0x00,0x00,0x0c,0xff,0xff,0xff,0xf3,0x00,0x00,0x00,0x00,0x00,0x00,0x5f,0xff,0xff,0xff,0x70,0x00,0x00,0x00,0x00,  //.........%@@@@@@@.............+@@@@@@@+........
0x00,0x00,0x00,0x00,0x0e,0xff,0xff,0xff,0xe0,0x00,0x00,0x00,0x00,0x00,0x00,0x5f,0xff,0xff,0xff,0x70,0x00,0x00,0x00,0x00,  //.........@@@@@@@@.............+@@@@@@@+........
0x00,0x00,0x00,0x00,0x3f,0xff,0xff,0xff,0xc0,0x00,0x00,0x00,0x00,0x00,0x00,0x5f,0xff,0xff,0xff,0x70,0x00,0x00,0x00,0x00,  //.........@@@@@@@%.............+@@@@@@@+........
0x00,0x00,0x00,0x00,0x6f,0xff,0xff,0xff,0x90,0x00,0x00,0x00,0x00,0x00,0x00,0x5f,0xff,0xff,0xff,0x70,0x00,0x00,0x00,0x00,  //........+@@@@@@@+.............+@@@@@@@+........
0x00,0x00,0x00,0x00,0x9f,0xff,0xff,0xff,0x60,0x00,0x00,0x00,0x00,0x00,0x00,0x5f,0xff,0xff,0xff,0x70,0x00,0x00,0x00,0x00,  //........+@@@@@@@+.............+@@@@@@@+........
0x00,0x00,0x00,0x00,0xcf,0xff,0xff,0xff,0x30,0x00,0x00,0x00,0x00,0x00,0x00,0x5f,0xff,0xff,0xff,0x70,0x00,0x00,0x00,0x00,  //........%@@@@@@@..............+@@@@@@@+........
0x00,0x00,0x00,0x00,0xef,0xff,0xff,0xfe,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5f,0xff,0xff,0xff,0x70,0x00,0x00,0x00,0x00,  //........@@@@@@@@..............+@@@@@@@+........
0x00,0x00,0x00,0x03,0xff,0xff,0xff,0xfc,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5f,0xff,0xff,0xff,0x70,0x00,0x00,0x00,0x00,  //........@@@@@@@%..............+@@@@@@@+........
0x00,0x00,0x00,0x06,0xff,0xff,0xff,0xf9,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5f,0xff,0xff,0xff,0x70,0x00,0x00,0x00,0x00,  //.......+@@@@@@@+..............+@@@@@@@+........
0x00,0x00,0x00,0x08,0xff,0xff,0xff,0xf6,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5f,0xff,0xff,0xff,0x70,0x00,0x00,0x00,0x00,  //.......+@@@@@@@+..............+@@@@@@@+........
0x00,0x00,0x00,0x0b,0xff,0xff,0xff,0xf3,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5f,0xff,0xff,0xff,0x70,0x00,0x00,0x00,0x00,  //.......%@@@@@@@...............+@@@@@@@+........
0x00,0x00,0x00,0x0e,0xff,0xff,0xff,0xe0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5f,0xff,0xff,0xff,0x70,0x00,0x00,0x00,0x00,  //.......@@@@@@@@...............+@@@@@@@+........
0x00,0x00,0x00,0x2f,0xff,0xff,0xff,0xc0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5f,0xff,0xff,0xff,0x70,0x00,0x00,0x00,0x00,  //.......@@@@@@@%...............+@@@@@@@+........
0x00,0x00,0x00,0x5f,0xff,0xff,0xff,0x90,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5f,0xff,0xff,0xff,0x70,0x00,0x00,0x00,0x00,  //......+@@@@@@@+...............+@@@@@@@+........
0x00,0x00,0x00,0x8f,0xff,0xff,0xff,0x60,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5f,0xff,0xff,0xff,0x70,0x00,0x00,0x00,0x00,  //......+@@@@@@@+...............+@@@@@@@+........
0x00,0x00,0x00,0xbf,0xff,0xff,0xff,0x30,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5f,0xff,0xff,0xff,0x70,0x00,0x00,0x00,0x00,  //......%@@@@@@@................+@@@@@@@+........
0x00,0x00,0x00,0xef,0xff,0xff,0xfe,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5f,0xff,0xff,0xff,0x70,0x00,0x00,0x00,0x00,  //......@@@@@@@@................+@@@@@@@+........
0x00,0x00,0x02,0xff,0xff,0xff,0xfc,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5f,0xff,0xff,0xff,0x70,0x00,0x00,0x00,0x00,  //......@@@@@@@%................+@@@@@@@+........
0x00,0x00,0x05,0xff,0xff,0xff,0xf9,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5f,0xff,0xff,0xff,0x70,0x00,0x00,0x00,0x00,  //.....+@@@@@@@+................+@@@@@@@+........
0x00,0x00,0x08,0xff,0xff,0xff,0xf6,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5f,0xff,0xff,0xff,0x70,0x00,0x00,0x00,0x00,  //.....+@@@@@@@+................+@@@@@@@+........
0x00,0x00,0x0b,0xff,0xff,0xff,0xf3,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5f,0xff,0xff,0xff,0x70,0x00,0x00,0x00,0x00,  //.....%@@@@@@@.................+@@@@@@@+........
0x00,0x00,0x0e,0xff,0xff,0xff,0xf0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5f,0xff,0xff,0xff,0x70,0x00,0x00,0x00,0x00,  //.....@@@@@@@@.................+@@@@@@@+........
0x00,0x00,0x2f,0xff,0xff,0xff,0xc0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5f,0xff,0xff,0xff,0x70,0x00,0x00,0x00,0x00,  //.....@@@@@@@%.................+@@@@@@@+........
0x00,0x00,0x5f,0xff,0xff,0xff,0x90,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5f,0xff,0xff,0xff,0x70,0x00,0x00,0x00,0x00,  //....+@@@@@@@+.................+@@@@@@@+........
0x00,0x00,0x8f,0xff,0xff,0xff,0x60,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5f,0xff,0xff,0xff,0x70,0x00,0x00,0x00,0x00,  //....+@@@@@@@+.................+@@@@@@@+........
0x00,0x00,0xaf,0xff,0xff,0xff,0xea,0xaa,0xaa,0xaa,0xaa,0xaa,0xaa,0xaa,0xaa,0xff,0xff,0xff,0xff,0xfa,0xaa,0xa7,0x00,0x00,  //....%@@@@@@@@%%%%%%%%%%%%%%%%%@@@@@@@@@%%%%+...
0x00,0x00,0xdf,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xfb,0x00,0x00,  //....%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%...
0x00,0x01,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xfb,0x00,0x00,  //....@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%...
0x00,0x04,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xfb,0x00,0x00,  //....@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%...
0x00,0x07,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xfb,0x00,0x00,  //...+@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%...
0x00,0x0a,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xfb,0x00,0x00,  //...%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%...
0x00,0x0f,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xfb,0x00,0x00,  //...@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%...
0x00,0x0f,0xff,0xff,0xff,0xf8,0x88,0x88,0x88,0x88,0x88,0x88,0x88,0x88,0x88,0xef,0xff,0xff,0xff,0xf8,0x88,0x86,0x00,0x00,  //...@@@@@@@@+++++++++++++++++++@@@@@@@@@+++++...
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5f,0xff,0xff,0xff,0x70,0x00,0x00,0x00,0x00,  //..............................+@@@@@@@+........
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5f,0xff,0xff,0xff,0x70,0x00,0x00,0x00,0x00,  //..............................+@@@@@@@+........
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5f,0xff,0xff,0xff,0x70,0x00,0x00,0x00,0x00,  //..............................+@@@@@@@+........
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5f,0xff,0xff,0xff,0x70,0x00,0x00,0x00,0x00,  //..............................+@@@@@@@+........
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5f,0xff,0xff,0xff,0x70,0x00,0x00,0x00,0x00,  //..............................+@@@@@@@+........
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5f,0xff,0xff,0xff,0x70,0x00,0x00,0x00,0x00,  //..............................+@@@@@@@+........
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5f,0xff,0xff,0xff,0x70,0x00,0x00,0x00,0x00,  //..............................+@@@@@@@+........
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5f,0xff,0xff,0xff,0x70,0x00,0x00,0x00,0x00,  //..............................+@@@@@@@+........
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5f,0xff,0xff,0xff,0x70,0x00,0x00,0x00,0x00,  //..............................+@@@@@@@+........
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5f,0xff,0xff,0xff,0x70,0x00,0x00,0x00,0x00,  //..............................+@@@@@@@+........
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5f,0xff,0xff,0xff,0x70,0x00,0x00,0x00,0x00,  //..............................+@@@@@@@+........
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5f,0xff,0xff,0xff,0x70,0x00,0x00,0x00,0x00,  //..............................+@@@@@@@+........

};

sgl_icon_t test_icon = {.bitmap = test, .width = 48, .height = 56};

sgl_img_t bg_img = {.bitmap = bg_test, .width = 240, .height = 320,};
sgl_img_t btn_img = {.bitmap = button_img, .width = 98, .height = 32,};
sgl_img_t icon_img = {.bitmap = icon_test, .width = 53, .height = 53,};


sgl_img_t sw_on_img = {.bitmap = sw_on, .width = 123, .height = 34,};
sgl_img_t sw_off_img = {.bitmap = sw_off, .width = 123, .height = 34,};

int stdout_device(char *str)
{
    return printf("%s\n", str);
}


void anim_arcbar(sgl_anim_t *anim, void *data)
{
    static uint8_t count = 0;
    if(count > 100) {
        count = 0;
    }
    sgl_arcbar_set_value(anim->obj, count);
    count ++ ;
}

void sw_event(sgl_obj_t *obj, void *data)
{
    if(sgl_obj_get_event_status(obj) == SGL_EVENT_PRESSED) {
        if(sgl_switch_get_status(obj)) {
            printf("ON\n");
            //sgl_draw_icon_lines_on_bg(sgl_get_active_surf(NULL), 10, 250, 30, 20, SGL_BLUE, &test_icon);
        }
        else {
            printf("OFF\n");
        }
    }
}



int main( int argc, char * argv[] )
{
    int quit = 0;
    if ( SDL_Init(SDL_INIT_VIDEO | SDL_INIT_TIMER) != 0 )
        return -1;
    sdl_show_windows(&m_window, &m_renderer);

    sgl_device_panel_t sdl_panel = {
                                    //.framebuffer = sdl2_frame_buffer,
                                    .framebuffer = sdl2_draw_buffer,
                                    .buffer_size = sizeof(sdl2_draw_buffer),
                                    .xres = FRAME_BUFFER_XRES,
                                    .yres = FRAME_BUFFER_YRES,
                                    .xres_virtual = FRAME_BUFFER_XRES_VIRTUAL,
                                    .yres_virtual = FRAME_BUFFER_YRES_VIRTUAL,
                                    .flush_area = sdl2_disp_area
                                    };
    
    sgl_device_input_t sdl_mouse = {
                                    .get = sdl_mouse_get,
                                   };

    sgl_device_stdout_t stdout_dev = {
                                    .put = stdout_device,
                                    };

    sgl_device_register(&sdl_panel, &sdl_mouse);
    
    sgl_device_stdout_register(&stdout_dev);

    sgl_init();

    SGL_LOG_INFO("start sgl...");

    main_page = sgl_page_create();
    two_page = sgl_page_create();

    sgl_page_set_background(main_page, &bg_img);

    sgl_page_set_active(main_page);

    int alpha = 0;

    sgl_style_t icon_style = {.body_color = SGL_RED, .text_color = SGL_WHITE, .radius = 12};
    sgl_obj_t* app1 = sgl_rect_create(main_page);
    sgl_obj_set_size(app1, 40, 40);
    sgl_obj_set_pos(app1, 10, 10);
    sgl_obj_set_style(app1, &icon_style);
    sgl_obj_set_event_cb(app1, btn_event, NULL);
    sgl_obj_set_alpha(app1, alpha);
    sgl_obj_set_bgimg(app1, &icon_img);

    //alpha += 50;

    sgl_obj_t* app2 = sgl_rect_create(main_page);
    sgl_obj_set_size(app2, 40, 40);
    sgl_obj_set_pos(app2, 70, 10);
    sgl_obj_set_style(app2, &icon_style);
    sgl_obj_set_event_cb(app2, btn_event, NULL);
    sgl_obj_set_alpha(app2, alpha);
    sgl_obj_set_bgimg(app2, &icon_img);

    //alpha += 50;

    sgl_obj_t* app3 = sgl_rect_create(main_page);
    sgl_obj_set_size(app3, 40, 40);
    sgl_obj_set_pos(app3, 130, 10);
    sgl_obj_set_style(app3, &icon_style);
    sgl_obj_set_event_cb(app3, btn_event, NULL);
    sgl_obj_set_alpha(app3, alpha);
    sgl_obj_set_bgimg(app3, &icon_img);

    //alpha += 50;

    sgl_obj_t* app4 = sgl_rect_create(main_page);
    sgl_obj_set_size(app4, 40, 40);
    sgl_obj_set_pos(app4, 190, 10);
    sgl_obj_set_style(app4, &icon_style);
    sgl_obj_set_event_cb(app4, btn_event, NULL);
    sgl_obj_set_alpha(app4, alpha);
    sgl_obj_set_bgimg(app4, &icon_img);


    sgl_obj_t *arcbar = sgl_arcbar_create(main_page, 50);
    sgl_obj_set_size(arcbar, 40, 40);
    sgl_obj_set_style(arcbar, &icon_style);
    sgl_obj_set_pos(arcbar, 170, 120);
    sgl_arcbar_set_font(arcbar, &song12);
    sgl_arcbar_set_thick(arcbar, 3);

    sgl_anim_t amin;
    sgl_anim_set_anim_cb(&amin, anim_arcbar, NULL);
    sgl_anim_set_times(&amin, 100);
    sgl_anim_set_interval(&amin, 40);
    sgl_anim_bind_obj(&amin, arcbar);
    sgl_anim_set_endless(&amin, true);
    sgl_anim_exec(&amin);


    sgl_obj_t* line = sgl_hline_create(main_page);
    sgl_obj_set_size(line, 240, 2);
    sgl_obj_set_pos(line, 0, 200);
    sgl_obj_set_style(line, &icon_style);
    sgl_obj_set_alpha(line, alpha);



    sgl_style_t rect_style = {.body_color = SGL_BLUE, .text_color = SGL_WHITE, .radius = 2};
    sgl_obj_t* rect = sgl_rect_create(main_page);
    sgl_obj_set_size(rect, 158, 5);
    sgl_obj_set_pos(rect, 50, 100);
    sgl_obj_set_style(rect, &rect_style);
    //sgl_obj_set_event_cb(rect, btn_event, NULL);
    sgl_obj_set_alpha(rect, alpha);
    //sgl_obj_set_bgimg(rect, &icon_img);

    sgl_style_t line2_style = {.body_color = sgl_rgb(80,80,80), .text_color = SGL_WHITE, .radius = 12};
    sgl_obj_t* line2 = sgl_vline_create(main_page);
    sgl_obj_set_size(line2, 1, 20);
    sgl_obj_set_pos(line2, 80, 102);
    sgl_obj_set_style(line2, &line2_style);
    sgl_obj_set_alpha(line2, alpha);

    sgl_style_t label_style = {.body_color = SGL_BLUE, .text_color = SGL_WHITE, .radius = 8};
    sgl_obj_t* label = sgl_label_create(main_page);
    sgl_obj_set_size(label, 80, 20);
    sgl_obj_set_pos(label, 20, 220);
    sgl_obj_set_bgimg(label, &bg_img);
    sgl_obj_set_style(label, &label_style);
    sgl_label_set_font(label, &song12);
    sgl_label_set_text_align(label, SGL_ALIGN_CENTER_MID);
    sgl_label_set_text(label, "SGL");
    sgl_obj_set_alpha(label, 255);

    sgl_style_t btn_style = {.body_color = SGL_BLUE, .text_color = SGL_RED, .radius = 16};
    sgl_obj_t* btn = sgl_button_create(main_page);
    sgl_obj_set_size(btn, 98, 32);
    sgl_obj_set_align(btn, SGL_ALIGN_BOT_RIGHT);
    sgl_obj_set_style(btn, &btn_style);
    sgl_obj_set_bgimg(btn, &btn_img);
    sgl_obj_set_event_cb(btn, btn_event, NULL);
    sgl_button_set_toggle_color(btn, SGL_GREEN);
    sgl_button_set_font(btn, &song12);
    //sgl_button_set_text(btn, "Button");

    sgl_style_t sw_style = {.body_color = sgl_rgb(255,255,255), .text_color = SGL_BLUE, .radius = 17};
    sgl_obj_t* sw = sgl_switch_create(main_page, true);
    sgl_obj_set_size(sw, 124, 34);
    sgl_obj_set_align(sw, SGL_ALIGN_CENTER_LEFT);
    sgl_obj_set_style(sw, &sw_style);
    sgl_obj_set_event_cb(sw, sw_event, NULL);
    sgl_switch_set_toggle_color(sw, SGL_BLUE);
    sgl_switch_set_status(sw, false);
    sgl_obj_set_bgimg(sw, &sw_on_img);
    sgl_switch_set_toggle_img(sw, &sw_off_img);


    SGL_LOG_INFO("sgl_trigo_cos = %d\n", -15);

    sgl_obj_t* string = sgl_string_create(main_page);
    sgl_obj_set_size(string, 200, 200);
    sgl_obj_set_pos(string, 65, 250);
    sgl_obj_set_style(string, &sw_style);
    sgl_string_set_text(string, "A");
    sgl_string_set_font(string, &song23);

    SDL_TimerID timer = SDL_AddTimer(50, fb_update, NULL);//创立定时器timer
    SDL_TimerID timer_tick = SDL_AddTimer(5, sgl_system_tick, NULL);//创立定时器timer
    SDL_AddEventWatch(sgl_mouse_event_interrupt, NULL);


    while (!quit)
    {
        SDL_WaitEvent(&myEvent);
        switch (myEvent.type)
        {
                        
        case SDL_QUIT:
            quit = 1;
            break;
        }
    }
	SDL_RemoveTimer(timer);
    SDL_DestroyWindow( m_window );
    SDL_DestroyRenderer( m_renderer );
    SDL_Quit();
    return 1;
}
